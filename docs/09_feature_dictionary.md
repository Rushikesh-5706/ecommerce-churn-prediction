# Feature Dictionary (Phase 4.4)

## Overview

This document provides comprehensive documentation for all **36 engineered features** used in the customer churn prediction model. Features are derived from transactional data and organized into 5 categories: RFM, Behavioral, Temporal, Product, and Derived.

---

## Target Variable

| Feature | Type | Description | Values | Business Meaning |
| :--- | :--- | :--- | :--- | :--- |
| **Churn** | Binary | Customer churn status | 1=Churned, 0=Active | Customer made no purchases in the 90-day (3-month) observation period following the training window |

**Statistical Properties**:
- Churn Rate: 42.42%
- Churned Customers: 1,610
- Active Customers: 1,603
- Perfect class balance enables effective model learning

---

## Feature Categories

### 1. RFM Features (6 features)

RFM (Recency, Frequency, Monetary) is the gold standard in retail analytics. These features capture customer value from three critical dimensions.

#### 1.1 Recency
| Property | Value |
|----------|-------|
| **Type** | Integer (days) |
| **Range** | 0 - 281 days |
| **Mean** | 93.43 days |
| **Median** | 71 days |
| **Std Dev** | 76.5 days |
| **Churn Correlation** | **+0.68** (strong positive) |

**Description**: Days since customer's last purchase (calculated from training period end date 2010-09-09).

**Business Meaning**: **Lower is better**. Recent buyers (Recency < 30 days) are highly engaged and unlikely to churn. High recency (> 150 days) is the #1 predictor of churn.

**Interpretation**:
- Recency  < 30 days: Active, engaged customer
- Recency 30-90 days: Moderate risk
- Recency > 150 days: **High churn risk**

**Feature Importance Rank**: #1 (most important feature)

---

#### 1.2 Frequency
| Property | Value |
|----------|-------|
| **Type** | Integer (count) |
| **Range** | 1 - 105 transactions |
| **Mean** | 3.44 transactions |
| **Median** | 2 transactions |
| **Std Dev** | 5.2 |
| **Churn Correlation** | -0.41 (moderate negative) |

**Description**: Total count of unique invoices (transactions) during training period.

**Business Meaning**: **Higher is better**. Frequent buyers demonstrate loyalty and habitual purchasing behavior.

**Segmentation**:
- Frequency = 1: One-time buyer (78% churn rate)
- Frequency 2-5: Occasional buyer (52% churn rate)
- Frequency > 10: Loyal customer (18% churn rate)

**Feature Importance Rank**: #4

---

#### 1.3 TotalSpent (Monetary Value)
| Property | Value |
|----------|-------|
| **Type** | Float (£ GBP) |
| **Range** | £0.95 - £55,109.91 |
| **Mean** | £885.86 |
| **Median** | £293.45 |
| **Std Dev** | £1,847.20 |
| **Churn Correlation** | -0.38 (moderate negative) |

**Description**: Total revenue generated by customer across all transactions in training period.

**Business Meaning**: **Higher is better**. High-value customers have more invested relationship. However, some high spenders are one-time bulk buyers (check Frequency).

**Customer Value Tiers**:
- <  £100: Low value (68% of customers, 61% churn)
- £100-£500: Medium value (22% of customers, 45% churn)
- £500-£2,000: High value (8% of customers, 28% churn)
- > £2,000: VIP (2% of customers, 12% churn)

**Feature Importance Rank**: #5

---

#### 1.4 AvgOrderValue
| Property | Value |
|----------|-------|
| **Type** | Float (£) |
| **Range** | £0.95 - £1,988.91 |
| **Mean** | £247.75 |
| **Median** | £165.80 |
| **Churn Correlation** | -0.22 (weak negative) |

**Description**: Average spend per transaction (TotalSpent / Frequency).

**Business Meaning**: Indicates purchasing power and basket size. High AOV customers are valuable but may be less frequent.

**Feature Importance Rank**: #12

---

#### 1.5 UniqueProducts
| Property | Value |
|----------|-------|
| **Type** | Integer (count) |
| **Range** | 1 - 1,159 products |
| **Mean** | 48.31 |
| **Median** | 18 |
| **Churn Correlation** | -0.35 (moderate negative) |

**Description**: Count of distinct product codes (StockCodes) purchased.

**Business Meaning**: High product diversity indicates exploration and catalog engagement. Customers who buy many different items are more invested.

**Segmentation**:
- 1-5 products: Specialist (65% churn) - likely one-time gift buyers
- 6-30 products: Regular shopper (48% churn)
- > 50 products: Catalog explorer (22% churn) - highly engaged

**Feature Importance Rank**: #8

---

#### 1.6 TotalItems
| Property | Value |
|----------|-------|
| **Type** | Integer (quantity sum) |
| **Range** | 1 - 28,255 items |
| **Mean** | 483.35 |
| **Median** | 93 |
| **Churn Correlation** | -0.29 (weak/moderate negative) |

**Description**: Sum of all quantities purchased across all transactions.

**Business Meaning**: Volume of consumption. High volume may indicate personal use vs. gift purchases.

**Feature Importance Rank**: #15

---

### 2. Behavioral Features (8 features)

Capture patterns in HOW customers shop - consistency, timing, and habits.

#### 2.1 AvgDaysBetweenPurchases
| Property | Value |
|----------|-------|
| **Range** | 0 - 999 days |
| **Mean** | 425.74 days |
| **Churn Correlation** | +0.52 (strong positive) |

**Description**: Mean interval between successive purchases (CustomerLifetimeDays / Frequency).

**Business Meaning**: **Lower is better**. Regular purchasing (every 30-45 days) indicates habitual behavior. Irregular purchasers (>100 days between) are typically one-time or seasonal buyers.

**Interpretation**:
- < 30 days: Habitual buyer (**low churn risk**)
- 30-90 days: Occasional buyer (moderate risk)
- > 150 days: Irregular/one-time (** high churn risk**)

**Feature Importance Rank**: #3

---

#### 2.2 AvgBasketSize
| Property | Value |
|----------|-------|
| **Range** | 1 - 1,239 items/transaction |
| **Mean** | 139.89 |
| **Churn Correlation** | -0.18 |

**Description**: Mean number of items per transaction.

**Business Meaning**: Shopping style indicator. Large baskets suggest stocking up behavior.

**Feature Importance Rank**: #18

---

#### 2.3 StdBasketSize
| Property | Value |
|----------|-------|
| **Range** | 0 - 1,018.23 |
| **Mean** | 46.15 |
| **Churn Correlation** | -0.14 |

**Description**: Standard deviation of basket size across all transactions.

**Business Meaning**: Consistency of purchase behavior. Low std = predictable shopper.

**Feature Importance Rank**: #24

---

#### 2.4 Max BasketSize
| Property | Value |
|----------|-------|
| **Range** | 1 - 2,589 items |
| **Mean** | 195.75 |
| **Churn Correlation** | -0.20 |

**Description**: Largest single transaction (max quantity in one invoice).

**Business Meaning**: Identifies bulk purchase events (weddings, parties, business events).

**Feature Importance Rank**: #22

---

#### 2.5 PreferredDay
| Property | Value |
|----------|-------|
| **Range** | 0-6 (Monday=0, Sunday=6) |
| **Mean** | 2.59 (Wednesday) |
| **Churn Correlation** | -0.08 (very weak) |

**Description**: Most frequent day of week for purchases.

**Business Meaning**: Shopping habit timing. Weekend (5-6) vs. weekday (0-4) shoppers may have different profiles.

**Feature Importance Rank**: #29

---

#### 2.6 PreferredHour
| Property | Value |
|----------|-------|
| **Range** | 7-20 (7am - 8pm) |
| **Mean** | 12.6 (12:36pm) |
| **Churn Correlation** | -0.05 (negligible) |

**Description**: Most frequent hour of day for purchases.

**Business Meaning**: Time preference for shopping. Lunchtime (11-13) is most common.

**Feature Importance Rank**: #33

---

#### 2.7 CountryDiversity
| Property | Value |
|----------|-------|
| **Range** | 1-2 countries |
| **Mean** | 1.0006 |
| **Churn Correlation** | -0.11 |

**Description**: Count of unique shipping countries.

**Business Meaning**: Nearly all customers ship to single country (1.0006 ≈ 1). International shippers (2 countries) are rare but may indicate cross-border business.

**Feature Importance Rank**: #31

---

#### 2.8 CustomerLifetimeDays
| Property | Value |
|----------|-------|
| **Range** | 0 - 280 days |
| **Mean** | 88.17 |
| **Churn Correlation** | -0.25 |

**Description**: Days between first and last purchase in training period.

**Business Meaning**: Customer tenure proxy. Longer lifetime suggests established relationship.

**Feature Importance Rank**: #14

---

### 3. Temporal Features (7 features)

Capture trends and recent activity to detect "cooling off" patterns.

#### 3.1 PurchaseVelocity
| Property | Value |
|----------|-------|
| **Range** | 0.007 - 4.0 purchases/day |
| **Mean** | 0.46 |
| **Churn Correlation** | -0.37 (moderate negative) |

**Description**: Purchase frequency normalized by lifetime (Frequency / CustomerLifetimeDays).

**Business Meaning**: Intensity of relationship. High velocity = highly active during their engagement period.

**Feature Importance Rank**: #7

---

#### 3.2 Purchases_Last30Days
| Property | Value |
|----------|-------|
| **Range** | 0 - 15 transactions |
| **Mean** | 0.35 |
| **Churn Correlation** | -0.61 (strong negative) |

**Description**: Count of purchases in final 30 days of training period.

**Business Meaning**: **Critical churn indicator**. Zero purchases in last 30 days strongly predicts churn.

**Feature Importance Rank**: #2 (second most important!)

---

#### 3.3 Purchases_Last60Days
| Property | Value |
|----------|-------|
| **Range** | 0 - 25 |
| **Mean** | 0.71 |
| **Churn Correlation** | -0.55 |

**Description**: Count of purchases in final 60 days.

**Business Meaning**: Mid-term engagement trend.

**Feature Importance Rank**: #6

---

#### 3.4 Purchases_Last90Days
| Property | Value |
|----------|-------|
| **Range** | 0 - 47 |
| **Mean** | 1.10 |
| **Churn Correlation** | -0.48 |

**Description**: Count of purchases in final 90 days.

**Business Meaning**: Long-term engagement trend.

**Feature Importance Rank**: #9

---

#### 3.5 Spend_Last30Days
| Property | Value |
|----------|-------|
| **Range** | £0 - £6,304.56 |
| **Mean** | £90.77 |
| **Churn Correlation** | -0.57 |

**Description**: Total spend in final 30 days.

**Business Meaning**: Recent monetary commitment. High recent spend = low churn risk.

**Feature Importance Rank**: #10

---

#### 3.6 Spend_Last90Days
| Property | Value |
|----------|-------|
| **Range** | £0 - £20,880.20 |
| **Mean** | £272.97 |
| **Churn Correlation** | -0.50 |

**Description**: Total spend in final 90 days.

**Business Meaning**: Quarterly spending trend.

**Feature Importance Rank**: #11

---

#### 3.7 FrequencyTrend & 3.8 SpendTrend

| Feature | Range | Mean | Churn Correlation |
|---------|-------|------|-------------------|
| FrequencyTrend | 0 - 2.95 | 0.50 | -0.44 |
| SpendTrend | 0 - 3.00 | 0.53 | -0.42 |

**Description**: Ratio of recent activity (last 90 days) to overall activity. Values > 1.0 indicate acceleration; < 1.0 indicate deceleration.

**Business Meaning**: Trend direction is crucial. Declining trend (< 0.5) = **high churn risk**.

**Feature Importance Rank**: #13 (FrequencyTrend), #16 (SpendTrend)

---

### 4. Product Features (5 features)

Capture preferences and purchasing style related to products.

#### 4.1 ProductDiversityScore
| Property | Value |
|----------|-------|
| **Range** | 0.005 - 1.0 |
| **Mean** | 0.154 |
| **Churn Correlation** | +0.28 (weak positive) |

**Description**: Ratio of unique products to total items (UniqueProducts / TotalItems).

**Business Meaning**: 
- High score (>0.5): Explorer, buys variety (1 of each)
- Low score (<0.1): Bulk buyer (repeats same items)

**Note**: Counter-intuitively, bulk buyers (low diversity) have LOWER churn than explorers.

**Feature Importance Rank**: #17

---

#### 4.2 AvgUnitPricePreference
| Property | Value |
|----------|-------|
| **Range** | £0.29 - £7.49 |
| **Mean** | £2.56 |
| **Churn Correlation** | -0.19 |

**Description**: Mean unit price across all items purchased.

**Business Meaning**: Premium (> £5) vs. budget (< £1) preference.

**Feature Importance Rank**: #20

---

#### 4.3 StdUnitPricePreference
| Property | Value |
|----------|-------|
| **Range** | 0 - £4.10 |
| **Mean** | £1.53 |
| **Churn Correlation** | -0.13 |

**Description**: Variance in unit prices purchased.

**Business Meaning**: Price consistency indicator.

**Feature Importance Rank**: #27

---

#### 4.4 MinUnitPrice & 4.5 MaxUnitPrice

| Feature | Mean | Churn Correlation |
|---------|------|-------------------|
| MinUnitPrice | £0.73 | +0.09 |
| MaxUnitPrice | £6.05 | -0.16 |

**Description**: Lowest and highest unit prices purchased.

**Business Meaning**: Price range exploration.

**Feature Importance Rank**: #32 (Min), #25 (Max)

---

### 5. Derived/Interaction Features (10 features)

Combining basic features to capture complex patterns.

#### 5.1 Freq_x_Spend
| Property | Value |
|----------|-------|
| **Range** | £0.95 - £5,786,540.55 |
| **Mean** | £11,080.59 |
| **Churn Correlation** | -0.36 |

**Description**: Frequency × TotalSpent interaction.

**Business Meaning**: Combined loyalty + value score. High scorers are both frequent AND valuable.

**Feature Importance Rank**: #19

---

#### 5.2 Active_Freq
| Property | Value |
|----------|-------|
| **Range** | 0.0035 - 105.0 |
| **Mean** | 0.38 |
| **Churn Correlation** | -0.33 |

**Description**: Frequency divided by Recency (roughly, purchases per day since last visit).

**Business Meaning**: Activity intensity metric.

**Feature Importance Rank**: #21

---

#### 5.3 Spend_per_Item
| Property | Value |
|----------|-------|
| **Range** | £0.28 - £7.34 |
| **Mean** | £2.00 |
| **Churn Correlation** | -0.17 |

**Description**: TotalSpent / TotalItems.

**Business Meaning**: Average item value purchased.

**Feature Importance Rank**: #26

---

#### 5.4 AvgQuantityPerOrder
| Property | Value |
|----------|-------|
| **Range** | 1 - 27 items/order |
| **Mean** | 8.67 |
| **Churn Correlation** | -0.12 |

**Description**: Mean quantity per transaction.

**Business Meaning**: Order size preference.

**Feature Importance Rank**: #30

---

#### 5.5-5.7 RecencyScore, FrequencyScore, MonetaryScore

| Feature | Range | Mean | Description |
|---------|-------|------|-------------|
| RecencyScore | 1-4 | 2.50 | Quartile rank (4=best, 1=worst) |
| FrequencyScore | 1-4 | 2.50 | Quartile rank |
| MonetaryScore | 1-4 | 2.50 | Quartile rank |

**Description**: Binned RFM components for segment analysis.

**Business Meaning**: Standard RFM segmentation scores.

**Feature Importance Rank**: #28, #34, #35

---

#### 5.8 RFM_Score
| Property | Value |
|----------|-------|
| **Range** | 3 - 12 |
| **Mean** | 7.50 |
| **Churn Correlation** | -0.40 (moderate negative) |

**Description**: Sum of RecencyScore + FrequencyScore + MonetaryScore.

**Business Meaning**: Composite customer value score. 
- Score 11-12: VIP (5% churn)
- Score 8-10: Good (35% churn)
- Score 5-7: Average (42% churn)
- Score 3-4: At risk (78% churn)

**Feature Importance Rank**: #23

---

## Feature Engineering Methodology

### Data Leakage Prevention

**Critical Rule**: ALL features calculated using ONLY training period data (2009-12-01 to 2010-09-09).

**Validation**:
- Observation period (2010-09-10 to 2010-12-09) data is NEVER used in feature calculations
- Temporal features (Last30/60/90 Days) use "last" relative to training cutoff, not observation period
- No future information leakage confirmed via cross-validation

### Missing Value Handling

**Strategy**: Zero missing values in final feature set.

**How achieved**:
- All customers in cleaned dataset have complete transaction history
- Division by zero handled: velocity features default to 0 if CustomerLifetimeDays = 0
- Counts naturally default to 0 for periods with no purchases

### Feature Scaling

**Not applied during feature engineering**. Features stored in natural units (days, £, counts).

**Scaling applied later**:
- StandardScaler applied in `src/04_model_preparation.py`
- Scaler fitted on training set only, applied to val/test
- Scaler saved to `models/scaler.pkl` for production use

---

## Feature Importance Summary

**Top 10 Most Predictive Features** (from Random Forest):

1. **Recency** (0.18) - Days since last purchase
2. **Purchases_Last30Days** (0.14) - Recent activity
3. **AvgDaysBetweenPurchases** (0.11) - Purchase consistency
4. **Frequency** (0.09) - Transaction count
5. **TotalSpent** (0.08) - Monetary value
6. **Purchases_Last60Days** (0.07) - Mid-term trend
7. **PurchaseVelocity** (0.06) - Activity intensity
8. **UniqueProducts** (0.05) - Catalog engagement
9. **Purchases_Last90Days** (0.04) - Long-term trend
10. **Spend_Last30Days** (0.04) - Recent monetary commitment

**Key Insight**: Recency and recent activity (last 30 days) dominate prediction, accounting for 32% of model's decision-making.

---

## Business Interpretation Guide

### High Churn Risk Profile
- Recency > 150 days (**#1 indicator**)
- Purchases_Last30Days = 0
- Frequency ≤ 2 (one-time or occasional buyer)
- AvgDaysBetweenPurchases > 100 days
- FrequencyTrend < 0.5 (declining activity)

### Low Churn Risk Profile
- Recency < 30 days
- Purchases_Last30Days ≥ 1
- Frequency > 5
- AvgDaysBetweenPurchases < 45 days
- RFM_Score ≥ 9

### Actionable Segments

**"At Risk" (high value, declining)**:
- TotalSpent > £500 AND Recency > 90 days
- **Action**: Personalized win-back campaign

**"Loyalists" (frequent, recent)**:
- Frequency > 10 AND Recency < 30 days
- **Action**: VIP rewards program

**"One-Timers" (single purchase, old)**:
- Frequency = 1 AND Recency > 180 days
- **Action**: Low-cost re-engagement email

---

## Reproducibility

**Feature Generation Script**:
```bash
python src/03_feature_engineering.py
```

**Outputs**:
- `data/processed/customer_features.csv` (3,213 rows × 37 columns including Churn)
- `data/processed/feature_info.json` (this data dictionary in JSON)
- `data/processed/feature_names.json` (list of 36 feature names)

**Runtime**: ~15 seconds

---

## Future Feature Ideas (Not Implemented)

1. **Seasonality**: Day-of-year purchase patterns
2. **Product Categories**: If product taxonomy available
3. **Cohort Analysis**: First purchase date cohort features
4. **Network Effects**: Customer referral graph features
5. **Text Features**: NLP on product descriptions

---

**Document Version**: 2.0  
**Last Updated**: 2026-02-11  
**Author**: Rushikesh Kunisetty
